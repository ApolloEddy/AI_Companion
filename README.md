# AI Companion ğŸ¤–ğŸ’¬

åŸºäº **Flutter** çš„ AI é™ªä¼´åº”ç”¨ï¼Œæ”¯æŒ **Windows** å’Œ **Android** å¹³å°ã€‚

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### ğŸ§  æ™ºèƒ½å¯¹è¯ç³»ç»Ÿ
- æ¥å…¥é˜¿é‡Œäº‘ **Qwen å¤§æ¨¡å‹** (qwen-max)
- æ”¯æŒ 30 ç§’è¯·æ±‚è¶…æ—¶ï¼Œè‡ªåŠ¨å¤„ç†ç½‘ç»œå¼‚å¸¸
- Token ç”¨é‡å®æ—¶ç»Ÿè®¡

### ğŸ’­ åŠ¨æ€æƒ…ç»ªç³»ç»Ÿ (`PersonaService`)
AI è§’è‰²æ‹¥æœ‰å®Œæ•´çš„æƒ…ç»ªæ¨¡å‹ï¼š
- **æƒ…ç»ªå‘é‡**ï¼šæ•ˆä»· (valence) + å”¤é†’åº¦ (arousal)
- **æƒ…ç»ªè±¡é™**ï¼šå¹³é™/å¼€å¿ƒ/å…´å¥‹/éš¾è¿‡/çƒ¦èº/ç´§å¼ 
- **æ—¶é—´è¡°å‡**ï¼šæƒ…ç»ªéšæ—¶é—´å‘åŸºå‡†å€¼å›å½’
- **äº’åŠ¨å“åº”**ï¼šç”¨æˆ·å¯¹è¯å½±å“æƒ…ç»ªæ³¢åŠ¨

### ğŸ• æ—¶é—´æ„ŸçŸ¥ (`TimeAwareness`)
- æ ¹æ®æ—¶é—´æ®µè°ƒæ•´é—®å€™è¯­ï¼ˆæ—©/ä¸­/æ™š/æ·±å¤œï¼‰
- æ„ŸçŸ¥å¯¹è¯é—´éš”ï¼Œä¹…åˆ«é‡é€¢æ—¶è¡¨è¾¾æƒ³å¿µ
- æ·±å¤œè‡ªåŠ¨å…³å¿ƒç”¨æˆ·ä¼‘æ¯

### ğŸ“ è®°å¿†ç³»ç»Ÿ (`MemoryService`)
- è‡ªåŠ¨è®°å½•é‡è¦å¯¹è¯å†…å®¹
- æœ€è¿‘ 100 æ¡è®°å¿†æŒä¹…åŒ–å­˜å‚¨
- ä¸Šä¸‹æ–‡ç›¸å…³è®°å¿†å¬å›

### ğŸ’¬ æ¶ˆæ¯åˆ†å‰² (`ResponseFormatter`)
æ¨¡æ‹Ÿå¾®ä¿¡èŠå¤©èŠ‚å¥ï¼š
- è‡ªåŠ¨å°†é•¿å›å¤åˆ†å‰²ä¸ºå¤šä¸ªæ°”æ³¡
- æ”¯æŒ `|||` åˆ†éš”ç¬¦å’Œè‡ªç„¶æ¢è¡Œ
- æ ¹æ®å”¤é†’åº¦åŠ¨æ€è°ƒæ•´åˆ†å‰²ç­–ç•¥

### ï¿½ èŠå¤©å†å² (`ChatHistoryService`)
- æŒä¹…åŒ–å­˜å‚¨æ‰€æœ‰èŠå¤©è®°å½•
- å¯åŠ¨æ—¶åŠ è½½æœ€è¿‘ 50 æ¡
- å‘ä¸Šæ»šåŠ¨åŠ¨æ€åŠ è½½æ›´å¤šå†å²
- æœ€å¤§å­˜å‚¨ 1000 æ¡

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
lib/
â”œâ”€â”€ main.dart                      # åº”ç”¨å…¥å£ï¼ŒProvider é…ç½®
â”œâ”€â”€ core/                          # æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ app_engine.dart                # ä¸»æ§åˆ¶å™¨ (ChangeNotifier)
â”‚   â”œâ”€â”€ llm_service.dart               # LLM API é€šä¿¡ + Token ç»Ÿè®¡
â”‚   â”œâ”€â”€ prompt_builder.dart            # ç³»ç»Ÿæç¤ºè¯æ„å»º
â”‚   â”œâ”€â”€ persona_service.dart           # æƒ…ç»ª/äº²å¯†åº¦çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ memory_service.dart            # è®°å¿†å­˜å‚¨
â”‚   â”œâ”€â”€ chat_history_service.dart      # èŠå¤©å†å²æŒä¹…åŒ–
â”‚   â”œâ”€â”€ time_awareness.dart            # æ—¶é—´æ„ŸçŸ¥æ¨¡å—
â”‚   â”œâ”€â”€ expression_selector.dart       # è¡¨è¾¾æ¨¡å¼é€‰æ‹©
â”‚   â”œâ”€â”€ response_formatter.dart        # æ¶ˆæ¯åˆ†å‰²æ ¼å¼åŒ–
â”‚   â”œâ”€â”€ settings_loader.dart           # YAML é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ theme_provider.dart            # ä¸»é¢˜ç®¡ç†
â”‚   â”œâ”€â”€ bubble_color_provider.dart     # æ°”æ³¡é¢œè‰²ç®¡ç†
â”‚   â”œâ”€â”€ config.dart                    # å¸¸é‡é…ç½®
â”‚   â”œâ”€â”€ models.dart                    # æ•°æ®æ¨¡å‹ (ChatMessage)
â”‚   â””â”€â”€ secrets.dart                   # API Key (gitignore)
â”‚
â”œâ”€â”€ ui/                            # ç”¨æˆ·ç•Œé¢
â”‚   â”œâ”€â”€ main_screen.dart               # ä¸»èŠå¤©ç•Œé¢
â”‚   â”œâ”€â”€ chat_bubble.dart               # æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
â”‚   â”œâ”€â”€ app_drawer.dart                # ä¾§è¾¹æ  (äººè®¾/é¢œè‰²/çŠ¶æ€)
â”‚   â””â”€â”€ settings_screen.dart           # è®¾ç½®é¡µé¢
â”‚
assets/settings/                   # YAML é…ç½®æ–‡ä»¶
â”œâ”€â”€ persona_settings.yaml          # äººæ ¼è¡¨è¾¾é…ç½®
â”œâ”€â”€ emotion_settings.yaml          # æƒ…ç»ªç³»ç»Ÿå‚æ•°
â”œâ”€â”€ time_settings.yaml             # æ—¶é—´æ„ŸçŸ¥é˜ˆå€¼
â””â”€â”€ response_settings.yaml         # æ¶ˆæ¯åˆ†å‰²é…ç½®
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Flutter SDK >= 3.10
- Dart SDK >= 3.0

### å®‰è£…æ­¥éª¤

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/AI_Companion.git
cd AI_Companion

# 2. é…ç½® API Key
cp lib/core/secrets.dart.example lib/core/secrets.dart
# ç¼–è¾‘ secrets.dartï¼Œå¡«å…¥ä½ çš„ DashScope API Key

# 3. å®‰è£…ä¾èµ–
flutter pub get

# 4. è¿è¡Œ
flutter run -d windows   # Windows
flutter run -d android   # Android
```

---

## ğŸ¨ UI åŠŸèƒ½

### ä¾§è¾¹æ  (å·¦æ»‘å”¤å‡º)
| åŠŸèƒ½ | æè¿° |
|------|------|
| **äººè®¾é…ç½®** | å¯ç¼–è¾‘ AI çš„åå­—ã€æ€§åˆ«ã€å¹´é¾„ã€æ€§æ ¼ã€å…´è¶£ |
| **æ°”æ³¡é¢œè‰²** | 12 ç§é¢„è®¾é¢œè‰²ï¼Œåˆ†åˆ«è®¾ç½®ç”¨æˆ·/AI æ°”æ³¡ |
| **å®æ—¶çŠ¶æ€** | æ˜¾ç¤ºæƒ…ç»ªè±¡é™ã€äº²å¯†åº¦ã€äº’åŠ¨æ¬¡æ•°ã€Token ç”¨é‡ |
| **ä¸»é¢˜åˆ‡æ¢** | æ—¥é—´/å¤œé—´/è·Ÿéšç³»ç»Ÿ |
| **æ¸…ç©ºè®°å½•** | ä¸€é”®æ¸…ç©ºèŠå¤©å†å² |

### äº¤äº’åŠ¨æ•ˆ
| ç‰¹æ€§ | æè¿° |
|------|------|
| **æ°”æ³¡åŠ¨ç”»** | æ–°æ¶ˆæ¯å¼¹å…¥æ—¶æœ‰ç¼©æ”¾+æ·¡å…¥åŠ¨ç”» |
| **æ‰“å­—æŒ‡ç¤ºå™¨** | AI æ€è€ƒæ—¶æ˜¾ç¤ºä¸‰ç‚¹æ³¢æµªåŠ¨ç”» |
| **æ–‡å­—é€‰æ‹©** | å¯é€‰ä¸­æ¶ˆæ¯æ–‡å­—ï¼Œé•¿æŒ‰å¤åˆ¶ |
| **å‘é€æŒ‰é’®åŠ¨ç”»** | å‘é€ä¸­æ—¶æŒ‰é’®æœ‰ç¼©æ”¾æ•ˆæœ |
| **SnackBar æµ®åŠ¨** | æç¤ºæ¶ˆæ¯ä¸é®æŒ¡è¾“å…¥æ¡† |

### èŠå¤©ç•Œé¢
- å‘ä¸Šæ»šåŠ¨è‡ªåŠ¨åŠ è½½å†å²æ¶ˆæ¯
- é•¿æ¶ˆæ¯è‡ªåŠ¨åˆ†æ¡æ˜¾ç¤º
- å‘é€æ—¶è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨

---

## âš™ï¸ YAML é…ç½®è¯´æ˜

ä¿®æ”¹ `assets/settings/` ä¸‹çš„é…ç½®æ–‡ä»¶å¯è°ƒæ•´ AI è¡Œä¸ºï¼š

### `emotion_settings.yaml`
```yaml
decay:
  valence_rate: 0.05   # æƒ…ç»ªæ•ˆä»·æ¯å°æ—¶è¡°å‡ç‡
  arousal_rate: 0.08   # å”¤é†’åº¦æ¯å°æ—¶è¡°å‡ç‡

update:
  base_valence_change: 0.05  # äº’åŠ¨æ—¶æ•ˆä»·å˜åŒ–é‡
  base_arousal_change: 0.08  # äº’åŠ¨æ—¶å”¤é†’åº¦å˜åŒ–é‡
```

### `time_settings.yaml`
```yaml
thresholds:           # æ—¶é—´é—´éš”é˜ˆå€¼ï¼ˆåˆ†é’Ÿï¼‰
  immediate: 2
  short: 30
  medium: 120
  long: 480
  day: 1440

greeting:
  acknowledge_absence:  # éœ€è¦è¡¨è¾¾æƒ³å¿µçš„é—´éš”ç±»å‹
    - long_gap
    - day_gap
    - week_gap
```

### `response_settings.yaml`
```yaml
splitting:
  separator: "|||"       # æ¶ˆæ¯åˆ†éš”ç¬¦
  max_parts: 5           # æœ€å¤§åˆ†æ¡æ•°
  max_single_length: 100 # å•æ¡æœ€å¤§é•¿åº¦
```

---

## ğŸ” å®‰å…¨è¯´æ˜

| é¡¹ç›® | å¤„ç†æ–¹å¼ |
|------|----------|
| API Key | å­˜å‚¨åœ¨ `secrets.dart`ï¼Œå·²æ·»åŠ åˆ° `.gitignore` |
| æœ¬åœ°æ•°æ® | ä½¿ç”¨ `SharedPreferences` å­˜å‚¨ |
| ç½‘ç»œé€šä¿¡ | HTTPS + Bearer Token è®¤è¯ |

---

## ï¿½ï¸ æ„å»ºå‘å¸ƒ

```bash
# Windows
flutter build windows

# Android APK
flutter build apk

# Android App Bundle
flutter build appbundle
```

---

## ğŸ“„ License

MIT License
