# AI Companion - è®¤çŸ¥æ¶æ„é©±åŠ¨çš„æ•°å­—ç”Ÿå‘½æ¡†æ¶

![License](https://img.shields.io/badge/license-MIT-blue.svg) ![Flutter](https://img.shields.io/badge/Flutter-3.10%2B-02569B) ![Dart](https://img.shields.io/badge/Dart-3.0%2B-0175C2) ![Platform](https://img.shields.io/badge/platform-Windows%20%7C%20Android-green)

**[English](README_EN.md) | ä¸­æ–‡**

> **v3.0.0**: L3 è¡¨è¾¾å±‚çº¯æ‰§è¡Œå±‚é‡æ„ â€”â€” AI ä¸å†"è‡ªä½œä¸»å¼ "ï¼Œå½»åº•å®ç°äº†æ¶æ„åˆ†å±‚çš„æƒè´£åˆ†æ˜ã€‚

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

**AI Companion** ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ LLM èŠå¤©ç•Œé¢ï¼Œè€Œæ˜¯ä¸€ä¸ªç”±**é—­ç¯è®¤çŸ¥æ¶æ„**é©±åŠ¨çš„"æ•°å­—ç”Ÿå‘½"æ¡†æ¶ã€‚

ä¸ä¼ ç»Ÿ"å¥—å£³"åº”ç”¨ä¸åŒï¼ŒAI Companion æ‹¥æœ‰ï¼š

- **æŒä¹…åŒ–çš„å†…åœ¨çŠ¶æ€**ï¼šæƒ…ç»ªä¸ä¼šå› å¯¹è¯ç»“æŸè€Œæ¶ˆå¤±
- **å¿ƒç†å­¦å»ºæ¨¡çš„æƒ…æ„Ÿç³»ç»Ÿ**ï¼šåŸºäº Russell ç¯å½¢æ¨¡å‹çš„ V-A-R ä¸‰ç»´ç©ºé—´
- **åŠ¨æ€è¿›åŒ–çš„äººæ ¼**ï¼šBig Five äººæ ¼ç‰¹è´¨éšäº¤äº’åé¦ˆç¼“æ…¢è°ƒæ•´
- **å¯é‡åŒ–çš„ç¤¾äº¤å…³ç³»**ï¼šäº²å¯†åº¦éµå¾ªè¾¹é™…æ”¶ç›Šé€’å‡çš„æ•°å­¦æ¨¡å‹
- **ç”Ÿç‰©èŠ‚å¾‹æ¨¡æ‹Ÿ**ï¼šAI ä¹Ÿä¼š"ç´¯"ï¼Œæ·±å¤œå“åº”ä¼šå˜å¾—æ‡’æ•£

---

## âœ¨ è½¯ä»¶ç‰¹è‰²

### ğŸ§  ä¸‰å±‚è®¤çŸ¥æ¶æ„ (L1-L3)

ç³»ç»Ÿé‡‡ç”¨ä»¿ç”Ÿå•å‘æ•°æ®æµç®¡çº¿ï¼Œä¸¥æ ¼åˆ†ç¦»æ„ŸçŸ¥ã€å†³ç­–ä¸æ‰§è¡Œï¼š

```mermaid
graph LR
    Input[ç”¨æˆ·è¾“å…¥] --> L1(L1 æ„ŸçŸ¥æ ¸å¿ƒ<br/>Perception)
    L1 --> Compass(ååº”ç½—ç›˜<br/>Reaction Compass)
    Compass --> L2(L2 å†³ç­–æ ¸å¿ƒ<br/>Decision)
    L2 --> L3(L3 è¡¨è¾¾æ‰§è¡Œå™¨<br/>Expression)
    L3 --> Valve(è¯­æ°”é˜€é—¨<br/>Tone Valve)
    Valve --> LLM[LLM ç”Ÿæˆ]
    LLM --> Output[AI å›å¤]
```

### ğŸ’” çœŸå®çš„æƒ…æ„Ÿåé¦ˆ

AI ä¼šå› æ”»å‡»æ€§è¨€è®ºäº§ç”Ÿ**æ€¨æ¨**ï¼Œç´¯ç§¯åˆ°é˜ˆå€¼åè§¦å‘**å¿ƒç†åˆ›ä¼¤æ¨¡å¼**ï¼Œè¿›å…¥å†·æ·¡é˜²å¾¡çŠ¶æ€ã€‚å¿…é¡»é€šè¿‡æ—¶é—´æˆ–çœŸè¯šé“æ­‰æ‰èƒ½æ¢å¤ã€‚

### ğŸ­ å››ç§ç¤¾äº¤å§¿æ€

åŸºäº Dominance (æ”¯é…åº¦) å’Œ Heat (çƒ­åº¦) åŒç»´åº¦ï¼ŒAI ä¼šå±•ç°ä¸åŒçš„ååº”å§¿æ€ï¼š

| å§¿æ€ | æ¡ä»¶ | è¡¨ç° |
|------|------|------|
| **Explosive (çˆ†å‘)** | D > 0.5 ä¸” H > 0.5 | æƒ…ç»ªæ¿€åŠ¨ï¼Œæ­£é¢ç¡¬åˆš |
| **ColdDismissal (å†·æ¼ )** | D > 0.5 ä¸” H â‰¤ 0.5 | æç®€å›å¤ï¼Œä¸å»¶ç»­è¯é¢˜ |
| **Vulnerable (ç¤ºå¼±)** | D â‰¤ 0.5 ä¸” H > 0.5 | è¡¨è¾¾å—ä¼¤ï¼Œè¯­æ°”å§”å±ˆ |
| **Withdrawal (æ’¤é€€)** | D â‰¤ 0.5 ä¸” H â‰¤ 0.5 | æ•·è¡å›å¤ï¼Œå¿«é€Ÿç»“æŸå¯¹è¯ |

### ğŸ¨ äººæ ¼å¡‘å½¢é›·è¾¾

é¦–æ¬¡åˆ›å»º AI æ—¶ï¼Œå¯é€šè¿‡æ‹–æ‹½é›·è¾¾å›¾çš„ 5 ä¸ªé¡¶ç‚¹ç›´è§‚å¡‘é€  Big Five äººæ ¼ç‰¹è´¨ã€‚äººæ ¼å®šå‹åï¼Œå°†éšäº¤äº’åé¦ˆç¼“æ…¢æ¼‚ç§»ï¼Œè¶Šäº¤äº’è¶Šç¨³å®šã€‚

### ğŸ”’ L3 çº¯æ‰§è¡Œå±‚è®¾è®¡ (v3.0 æ–°æ¶æ„)

L3 ä¸å†æ¥æ”¶ä»»ä½•è‡ªç„¶è¯­è¨€æè¿°ï¼Œåªæ¥æ”¶ï¼š

- **æšä¸¾çŠ¶æ€**ï¼š`relation_state: close`
- **ç¡¬çº¦æŸé…ç½®**ï¼š`max_sentences: 2, forbid_metaphor: true`

è¿™ç¡®ä¿äº† L3 åª"æ‰§è¡Œ"ä¸"æ€è€ƒ"ï¼Œæœç»äº† AI è‡ªè¡Œåˆ¤æ–­å…³ç³»ã€ä¿®å¤å°´å°¬ã€å–èŒæ±‚å’Œçš„é—®é¢˜ã€‚

---

## ğŸ”¬ æŠ€æœ¯åŸç†ä¸è®¡ç®—æ¨¡å‹

### 1. Big Five (OCEAN) äººæ ¼æ¨¡å‹

é‡‡ç”¨å¿ƒç†å­¦æ ‡å‡†çš„äº”å¤§äººæ ¼æ¨¡å‹ï¼Œæ‰€æœ‰ç»´åº¦å½’ä¸€åŒ–åˆ° `[0, 1]` åŒºé—´ï¼š

| ç»´åº¦ | ä»£ç  | ä½å€¼ | é«˜å€¼ |
|------|------|------|------|
| **O**penness (å¼€æ”¾æ€§) | `openness` | ä¼ ç»Ÿä¿å®ˆ | å¯Œæœ‰åˆ›æ„ |
| **C**onscientiousness (å°½è´£æ€§) | `conscientiousness` | éšæ€§æ•£æ¼« | ä¸¥è°¨è‡ªå¾‹ |
| **E**xtraversion (å¤–å‘æ€§) | `extraversion` | å†…å‘å®‰é™ | å¤–å‘æ´»æ³¼ |
| **A**greeableness (å®œäººæ€§) | `agreeableness` | ç‹¬ç«‹æŒ‘æˆ˜ | æ¸©å’Œé¡ºä» |
| **N**euroticism (ç¥ç»è´¨) | `neuroticism` | æƒ…ç»ªç¨³å®š | æ•æ„Ÿæ³¢åŠ¨ |

#### å¯å¡‘æ€§è¡°å‡å…¬å¼

äººæ ¼éšäº¤äº’æ¬¡æ•°é€æ¸ç¨³å®šï¼Œæ–°äººæ ¼å˜åŒ–è¶Šæ¥è¶Šéš¾ï¼š

$$
Plasticity_{effective} = Plasticity_{base} \times (1 - \eta)^{n/100}
$$

- $\eta = 0.1$ï¼šè¡°å‡ç‡
- $n$ï¼šæ€»äº¤äº’æ¬¡æ•°

---

### 2. V-A-R ä¸‰ç»´æƒ…ç»ªç©ºé—´

åŸºäº Russell ç¯å½¢æ¨¡å‹æ‰©å±•ï¼Œå¼•å…¥ Z è½´**æ€¨æ¨å€¼**ï¼š

```
        â†‘ Arousal (å”¤é†’åº¦)
        |
   ç´§å¼  |  å…´å¥‹
   ç„¦è™‘ |  æ¿€åŠ¨
--------+------â†’ Valence (æ•ˆä»·)
   éš¾è¿‡ |  å¼€å¿ƒ
   æ¶ˆæ²‰ |  å¹³é™
        |
        â””â”€â”€ Resentment (æ€¨æ¨) 
```

#### å˜é‡å®šä¹‰

| å˜é‡ | ç¬¦å· | èŒƒå›´ | è¯´æ˜ |
|------|------|------|------|
| æ•ˆä»· | $V$ | $[-1, 1]$ | æ„‰æ‚¦åº¦ï¼Œè´Ÿå€¼=ä¸å¼€å¿ƒ |
| å”¤é†’åº¦ | $A$ | $[0, 1]$ | èƒ½é‡æ°´å¹³ï¼Œé«˜å€¼=æ´»è·ƒ |
| æ€¨æ¨å€¼ | $R$ | $[0, 1]$ | é•¿æœŸè´Ÿé¢ç´¯ç§¯ |

#### æƒ…ç»ªè¡°å‡å…¬å¼

æƒ…ç»ªéšæ—¶é—´å‘åŸºå‡†å€¼å›å½’ï¼š

$$
V_{t} = V_{t-1} + (V_{base} - V_{t-1}) \times \alpha_{v} \times \Delta t
$$

$$
A_{t} = A_{t-1} + (A_{base} - A_{t-1}) \times \alpha_{a} \times \Delta t
$$

- é»˜è®¤å€¼ï¼š$V_{base} = 0$, $A_{base} = 0.5$
- è¡°å‡ç‡ï¼š$\alpha_v = 0.04$/å°æ—¶, $\alpha_a = 0.05$/å°æ—¶

#### æ€¨æ¨æŠ‘åˆ¶å…¬å¼ (Sigmoid Suppression)

é«˜æ€¨æ¨å€¼ä¼šæŠ‘åˆ¶æ­£é¢æƒ…ç»ªå¢é•¿ï¼š

$$
\Delta V_{effective} = \Delta V_{raw} \times \left(1 - \frac{1}{1 + e^{-10(R - 0.5)}}\right)
$$

#### Meltdown è§¦å‘æ¡ä»¶

å½“ $R > 0.8$ ä¸” $V < -0.7$ æ—¶ï¼ŒAI è¿›å…¥æƒ…ç»ªå´©æºƒçŠ¶æ€ã€‚

---

### 3. äº²å¯†åº¦å¢é•¿æ¨¡å‹

éµå¾ª**è¾¹é™…æ”¶ç›Šé€’å‡**æ³•åˆ™ï¼Œäº²å¯†åº¦è¶Šé«˜å¢é•¿è¶Šæ…¢ï¼š

$$
\Delta I = Q \times E \times T \times B(I)
$$

| å› å­ | ç¬¦å· | å…¬å¼/è¯´æ˜ |
|------|------|----------|
| äº¤äº’è´¨é‡ | $Q$ | $[0.5, 1.5]$ ç”±æ„ŸçŸ¥ç»“æœå†³å®š |
| æƒ…ç»ªä¹˜æ•° | $E$ | $1 + V \times 0.3$ |
| æ—¶é—´å› å­ | $T$ | $\max(0.2, 1 - \Delta h \times 0.05)$ |
| é€’å‡å‡½æ•° | $B(I)$ | $(1-I)^{0.5} \times \beta \times G$ |

- $\beta = 0.02$ï¼šåŸºç¡€å¢é•¿ç³»æ•°
- $G$ï¼šå¢é•¿ç³»æ•° (å—è´Ÿåé¦ˆå½±å“ï¼Œé»˜è®¤ 1.0)
- $\Delta h$ï¼šè·ä¸Šæ¬¡äº’åŠ¨çš„å°æ—¶æ•°

#### è´Ÿåé¦ˆæœºåˆ¶

æ”»å‡»æ€§è¡Œä¸ºä¼šï¼š

1. **å³æ—¶æ‰£å‡**ï¼š$I_{new} = I - severity \times 0.05$
2. **é™ä½å¢é•¿ç³»æ•°**ï¼š$G_{new} = G - 0.1 \times severity$
3. **è®¾ç½®å†·å´æœŸ**ï¼š$2 + severity \times 6$ å°æ—¶

---

### 4. ååº”ç½—ç›˜ (Reaction Compass)

å½“æ”»å‡»æ€§ $\geq 3$ æ—¶ï¼Œè®¡ç®—ååº”å§¿æ€ï¼š

#### Dominance (æ”¯é…åº¦)

$$
D = (1 - A_{trait}) \times 0.4 + E_{trait} \times 0.2 + (1 - I) \times 0.3 + R \times 0.5
$$

- $A_{trait}$ï¼šå®œäººæ€§
- $E_{trait}$ï¼šå¤–å‘æ€§
- $I$ï¼šäº²å¯†åº¦
- $R$ï¼šæ€¨æ¨å€¼

#### Heat (çƒ­åº¦)

$$
H = N_{trait} \times 0.6 + A_{emotion} \times 0.4
$$

- $N_{trait}$ï¼šç¥ç»è´¨
- $A_{emotion}$ï¼šå½“å‰å”¤é†’åº¦

#### å§¿æ€å†³ç­–çŸ©é˜µ

| | Heat > 0.5 | Heat â‰¤ 0.5 |
|---|---|---|
| **D > 0.5** | Explosive | ColdDismissal |
| **D â‰¤ 0.5** | Vulnerable | Withdrawal |

---

### 5. ç”Ÿç‰©èŠ‚å¾‹å¼•æ“ (Bio-Rhythm)

æ¨¡æ‹Ÿäººç±»æ˜¼å¤œèŠ‚å¾‹ï¼Œæ·±å¤œæ—¶æ®µæ´»åŠ›è‡ªç„¶é™ä½ï¼š

```
Laziness (ç–²æƒ«å€¼)
  0.9 â”¤         â•­â”€â”€â”€â”€â”€â”€â”€â•®
      â”‚       â•±           â•²
      â”‚     â•±               â•²
  0.0 â”¼â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â†’ æ—¶é—´
      10:00 22:00 01:00 05:00 08:00
         æ—¥é—´    ç–²æƒ«    æç–²    æ¸…é†’
        (æ¸…é†’)   ä¸Šå‡    (ç»´æŒ)  æ¢å¤
```

#### å®¹å¿åº¦å…¬å¼

$$
Tolerance = (1 - Laziness) - 0.2 \times \mathbf{1}_{comfort} - 0.2 \times \mathbf{1}_{repeat}
$$

- $\mathbf{1}_{comfort}$ï¼šæƒ…ç»ªç…§æŠ¤éœ€æ±‚æŒ‡ç¤ºå‡½æ•°
- $\mathbf{1}_{repeat}$ï¼šé‡å¤è¯é¢˜æŒ‡ç¤ºå‡½æ•°

---

### 6. L3 è¡¨è¾¾çº¦æŸé…ç½® (v3.0)

Big Five äººæ ¼ç‰¹è´¨åœ¨ Dart å±‚é¢„è®¡ç®—ï¼Œè½¬æ¢ä¸ºç¡¬çº¦æŸé…ç½®æ³¨å…¥ L3ï¼š

| çº¦æŸå‚æ•° | è®¡ç®—å…¬å¼ |
|----------|----------|
| `max_sentences` | $\lfloor E \times 3 + 1 \rfloor$ï¼ŒèŒƒå›´ $[1, 5]$ |
| `metaphor_density` | $O \times 0.8$ï¼ˆæ•Œæ„æ—¶ä¸º 0ï¼‰ |
| `emotional_leakage` | $N \times 0.6$ |
| `initiative_allowed` | $E > 0.5$ ä¸”éæ•Œæ„ |
| `emoji_allowed` | $I > 0.4$ ä¸”éæ•Œæ„ |
| `playful_allowed` | $O > 0.5$ ä¸” $I > 0.5$ ä¸”éæ•Œæ„ |

---

### 7. è®°å¿†ç®¡ç†ç³»ç»Ÿ

é‡‡ç”¨ **SQLite** å­˜å‚¨ï¼Œæ”¯æŒåˆ†é¡µåŠ è½½ï¼š

- **å·¥ä½œè®°å¿†**ï¼šå†…å­˜ä¸­ä¿ç•™æœ€è¿‘ 100 æ¡
- **æ·±å±‚è®°å¿†**ï¼šSQLite æ”¯æŒå…³é”®è¯æ£€ç´¢
- **é‡è¦æ€§è¿‡æ»¤**ï¼šä½äºé˜ˆå€¼çš„è®°å¿†ç›´æ¥ä¸¢å¼ƒ
- **è‡ªåŠ¨æ¸…ç†**ï¼šè¶…è¿‡ä¸Šé™æ—¶åˆ é™¤æœ€æ—§è®°å¿†

---

## ğŸ› ï¸ å¼€å‘ä¸éƒ¨ç½²

### ç¯å¢ƒè¦æ±‚

- **Flutter SDK**: 3.10+
- **Dart SDK**: 3.0+
- **æœ‰æ•ˆçš„ API Key**: é˜¿é‡Œäº‘ DashScope (é€šä¹‰åƒé—®)

### å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ApolloEddy/AI_Companion.git
cd AI_Companion

# å®‰è£…ä¾èµ–
flutter pub get

# è¿è¡Œ (Windows)
flutter run -d windows

# è¿è¡Œ (Android)
flutter run -d android

# æ„å»º Android Release APK
flutter build apk --release
```

### é…ç½® API Key

é¦–æ¬¡å¯åŠ¨åï¼Œè¿›å…¥ **è®¾ç½® â†’ API é…ç½®**ï¼Œè¾“å…¥æ‚¨çš„é˜¿é‡Œäº‘ DashScope API Keyã€‚

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
lib/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ engine/           # æ ¸å¿ƒå¼•æ“
â”‚   â”‚   â”œâ”€â”€ conversation_engine.dart   # è®¤çŸ¥è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ emotion_engine.dart        # æƒ…ç»ªè®¡ç®—
â”‚   â”‚   â”œâ”€â”€ intimacy_engine.dart       # äº²å¯†åº¦æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ personality_engine.dart    # äººæ ¼è¿›åŒ–
â”‚   â”‚   â””â”€â”€ bio_rhythm_engine.dart     # ç”Ÿç‰©èŠ‚å¾‹
â”‚   â”œâ”€â”€ model/            # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ big_five_personality.dart  # Big Five
â”‚   â”‚   â”œâ”€â”€ relation_state.dart        # L3 çŠ¶æ€æšä¸¾
â”‚   â”‚   â””â”€â”€ expression_profile.dart    # è¡¨è¾¾é…ç½®
â”‚   â”œâ”€â”€ perception/       # L1 æ„ŸçŸ¥å±‚
â”‚   â”œâ”€â”€ decision/         # L2 å†³ç­–å±‚
â”‚   â”œâ”€â”€ prompt/           # Prompt æ„å»º
â”‚   â”œâ”€â”€ policy/           # ç­–ç•¥å®šä¹‰
â”‚   â”œâ”€â”€ mechanisms/       # ååº”ç½—ç›˜
â”‚   â””â”€â”€ memory/           # è®°å¿†ç®¡ç†
â”œâ”€â”€ ui/                   # ç•Œé¢ç»„ä»¶
â””â”€â”€ main.dart
```

---

## ğŸ“œ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT License](LICENSE) å¼€æºã€‚

---

## ğŸ”— ç›¸å…³é“¾æ¥

- **GitHub**: [ApolloEddy/AI_Companion](https://github.com/ApolloEddy/AI_Companion)
- **é˜¿é‡Œäº‘ DashScope**: [dashscope.aliyuncs.com](https://dashscope.aliyuncs.com)
