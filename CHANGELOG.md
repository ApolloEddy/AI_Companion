# AI Companion æ›´æ–°æ—¥å¿—

## [v2.0.0] - 2025-12-25 ğŸ„

### ğŸš€ æ–°å¢ï¼šè®¤çŸ¥å¼•æ“ç³»ç»Ÿ

#### ç”¨æˆ·ç”»åƒå­¦ä¹ 
- æ–°å¢ `UserProfile` æ•°æ®æ¨¡å‹ï¼Œæ”¯æŒç©ºç™½åˆå§‹åŒ–
- æ–°å¢ `ProfileService` æŒä¹…åŒ–æœåŠ¡ï¼Œæ”¯æŒå¢é‡æ›´æ–°
- ç”¨æˆ·èº«ä»½ã€èŒä¸šã€èƒŒæ™¯ä»å¯¹è¯ä¸­è‡ªåŠ¨æå–ï¼Œè€Œéé¢„è®¾

#### å¤šé˜¶æ®µå¤„ç†å™¨
- æ–°å¢ `PerceptionProcessor` - æ·±åº¦æ„ŸçŸ¥å¤„ç†å™¨ï¼ˆé˜¶æ®µä¸€ï¼‰
  - åˆ†æç”¨æˆ·è¡¨é¢æƒ…ç»ªã€æ½œå°è¯ã€æ„å›¾
  - æ”¯æŒè§„åˆ™åŸºç¡€çš„å¿«é€Ÿåˆ†æ
- æ–°å¢ `ReflectionProcessor` - å†…å¿ƒåæ€å¤„ç†å™¨ï¼ˆé˜¶æ®µä¸‰ï¼‰
  - å›å¤å‰å†…éƒ¨æ€è€ƒï¼ŒåŠ¨æ€è°ƒæ•´å¯¹è¯é£æ ¼
  - ç”Ÿæˆå›å¤ç­–ç•¥æŒ‡å¯¼

#### ç¦æ­¢æ¨¡å¼æ£€æµ‹
- æ–°å¢ `ProhibitedPatterns` ç¡¬ç¼–ç è§„åˆ™ç³»ç»Ÿ
  - æ£€æµ‹é‡å¤æé—®ã€è¯´æ•™ã€è¿‡åº¦å…³å¿ƒç­‰æ¼äººæ¨¡å¼
  - è‡ªåŠ¨æ¸…ç†è¿è§„å†…å®¹

#### å¼‚æ­¥åæ€å¼•æ“
- æ–°å¢ `AsyncReflectionEngine` åå°å­¦ä¹ ç³»ç»Ÿ
  - å¯¹è¯é™é»˜ 3 åˆ†é’Ÿåè‡ªåŠ¨è§¦å‘
  - ä»å¯¹è¯ä¸­æå–ç”¨æˆ·ä¿¡æ¯å¹¶æ›´æ–°ç”»åƒ
  - è®°å½•é‡Œç¨‹ç¢‘äº‹ä»¶

#### åé¦ˆåˆ†æå™¨
- æ–°å¢ `FeedbackAnalyzer` ç”¨æˆ·è¡Œä¸ºåˆ†æ
  - ä»æ¶ˆæ¯é•¿åº¦ã€å“åº”å»¶è¿Ÿæ¨æ–­æ»¡æ„åº¦
  - è¯†åˆ«ä¸æ»¡ä¿¡å·ï¼Œå­¦ä¹ å¯¹è¯åå¥½

#### åˆ†å±‚è®°å¿†æ£€ç´¢
- æ–°å¢ `LayeredMemoryRetriever` å››å±‚è®°å¿†æ¶æ„
  - L1: å·¥ä½œè®°å¿†ï¼ˆå½“å‰å¯¹è¯ï¼‰
  - L2: æƒ…æ™¯è®°å¿†ï¼ˆè¿‘æœŸäº‹ä»¶ï¼‰
  - L3: è¯­ä¹‰è®°å¿†ï¼ˆç”¨æˆ·ç”»åƒï¼‰
  - L4: ç¨‹åºè®°å¿†ï¼ˆå¯¹è¯è§„åˆ™ï¼‰

### ğŸ› ä¿®å¤

#### ä¸»åŠ¨æ¶ˆæ¯æœºåˆ¶ä¼˜åŒ–
- **é—®é¢˜**: åŸ Flutter Timer åœ¨ Android åå°è¢«ç³»ç»Ÿæš‚åœï¼Œå¯¼è‡´ä¸»åŠ¨æ¶ˆæ¯å¤±æ•ˆ
- **è§£å†³**: æ”¹ä¸ºåº”ç”¨å¯åŠ¨æ—¶åˆ¤æ–­æ˜¯å¦éœ€è¦é—®å€™
  - æ—©å®‰é—®å€™ (6:00-10:00)
  - æ™šå®‰é—®å€™ (20:00-23:00)
  - ä¹…æœªè”ç³»é—®å€™ (>24å°æ—¶)
  - éšæœºæƒ³èµ· (10%æ¦‚ç‡)
- éšæœºå»¶è¿Ÿ 2-30 ç§’åå‘é€ï¼Œè‡ªç„¶ä¸çªå…€
- æ–°å¢ `StartupGreetingService` è½»é‡çº§æœåŠ¡

### âœ¨ æ”¹è¿›

#### ConversationEngine é›†æˆ
- é›†æˆç¦æ­¢æ¨¡å¼æ£€æŸ¥ï¼Œè‡ªåŠ¨æ¸…ç†è¿è§„è¾“å‡º
- é›†æˆå¼‚æ­¥åæ€å¼•æ“ï¼Œæ¯æ¬¡å¯¹è¯åè‡ªåŠ¨è®°å½•
- é›†æˆåé¦ˆåˆ†æå™¨ï¼Œè¿½è¸ªç”¨æˆ·è¡Œä¸ºä¿¡å·

#### LLM æœåŠ¡æ‰©å±•
- æ–°å¢ `completeWithSystem()` æ–¹æ³•ï¼Œæ”¯æŒæŒ‡å®šæ¨¡å‹å’Œå‚æ•°
- æ–°å¢ `streamComplete()` é¢„ç•™æ¥å£

#### æ¨¡å‹æ”¯æŒ
- æ–°å¢ Qwen3 Max (`qwen3-max`) - Qwen3 æœ€å¼ºæ€§èƒ½
- æ–°å¢ Qwen3 Flash (`qwen3-flash`) - Qwen3 æé€Ÿå“åº”

### ğŸ“ æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| ç”¨æˆ·ç”»åƒæ¨¡å‹ | `lib/core/model/user_profile.dart` |
|ç”»åƒæœåŠ¡ | `lib/core/service/profile_service.dart` |
| å¯åŠ¨é—®å€™æœåŠ¡ | `lib/core/service/startup_greeting_service.dart` |
| æ·±åº¦æ„ŸçŸ¥å¤„ç†å™¨ | `lib/core/engine/perception_processor.dart` |
| å†…å¿ƒåæ€å¤„ç†å™¨ | `lib/core/engine/reflection_processor.dart` |
| ç¦æ­¢æ¨¡å¼è§„åˆ™ | `lib/core/policy/prohibited_patterns.dart` |
| åé¦ˆåˆ†æå™¨ | `lib/core/engine/feedback_analyzer.dart` |
| åˆ†å±‚è®°å¿†æ£€ç´¢ | `lib/core/engine/memory_retriever.dart` |
| å¼‚æ­¥åæ€å¼•æ“ | `lib/core/engine/async_reflection_engine.dart` |
| é˜¶æ®µ Prompt æ¨¡æ¿ | `lib/core/prompt/stage_prompts.dart` |

### ğŸ”§ ä¿®æ”¹æ–‡ä»¶

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `conversation_engine.dart` | é›†æˆè®¤çŸ¥ç»„ä»¶ |
| `app_engine.dart` | åˆå§‹åŒ– ProfileService |
| `llm_service.dart` | æ·»åŠ æ–° API æ–¹æ³• |
| `config.dart` | æ·»åŠ æ–°æ¨¡å‹ |

---

## [v1.x] - ä¹‹å‰ç‰ˆæœ¬

- åŸºç¡€å¯¹è¯åŠŸèƒ½
- Valence/Arousal æƒ…ç»ªç³»ç»Ÿ
- ç­–ç•¥é©±åŠ¨ç”Ÿæˆå‚æ•°
- ä¸»åŠ¨æ¶ˆæ¯ç³»ç»Ÿ
- è®°å¿†ç®¡ç†
