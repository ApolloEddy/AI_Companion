# AI Companion - è®¤çŸ¥æ¶æ„æ¡†æ¶ (Cognitive Architecture Framework)

![License](https://img.shields.io/badge/license-MIT-blue.svg) ![Flutter](https://img.shields.io/badge/Flutter-3.0%2B-02569B) ![Dart](https://img.shields.io/badge/Dart-3.0%2B-0175C2)

**[English](README_EN.md) | [ä¸­æ–‡](README.md)**

> **v2.8.0 æ›´æ–°**: ç•Œé¢ç¾åŒ–å‡çº§ï¼æ–°å¢ä¸‹æ‹‰å¼æ€§åˆ«é€‰æ‹©ã€å…¨å±€å‘¼å¸åŠ¨ç”»åé¦ˆå¼¹çª—ï¼Œå¹¶ä¼˜åŒ–äº† Prompt æœ¬åœ°åŒ–ä½“éªŒã€‚

---

## ä¸­æ–‡æ–‡æ¡£

**AI Companion** æ˜¯ä¸€ä¸ªç”±**é—­ç¯è®¤çŸ¥æ¶æ„**é©±åŠ¨çš„â€œæ•°å­—ç”Ÿå‘½â€æ¡†æ¶ã€‚ä¸ç®€å•çš„å¥—å£³ LLM ä¸åŒï¼Œå®ƒæ‹¥æœ‰åŸºäºå¿ƒç†å­¦å»ºæ¨¡çš„å†…åœ¨çŠ¶æ€ã€æƒ…æ„ŸæŒä¹…æ€§ä»¥åŠåŠ¨æ€è¿›åŒ–çš„äººæ ¼ç³»ç»Ÿã€‚

## ğŸ—ï¸ ä¸‰å±‚è®¤çŸ¥æ¶æ„ (L1-L3)

ç³»ç»Ÿé‡‡ç”¨ä»¿ç”Ÿå•å‘æ•°æ®æµç®¡çº¿ï¼š

```mermaid
graph TD
    UserInput[ç”¨æˆ·è¾“å…¥] --> L1(L1: æ„ŸçŸ¥æ ¸å¿ƒ)
    L1 -->|æ„ŸçŸ¥ç»“æœ| L2(L2: å†³ç­–æ ¸å¿ƒ)
    L2 -->|å†…åœ¨çŠ¶æ€| L3(L3: è¡¨è¾¾æ ¸å¿ƒ)
    L3 -->|System Prompt| LLM[LLM ç”Ÿæˆ]
    LLM --> Output[AI å›å¤]
```

### L1: æ„ŸçŸ¥æ ¸å¿ƒ (Perception Core)

è´Ÿè´£â€œå¬â€å’Œâ€œæ„Ÿè§‰â€ï¼Œè€Œéâ€œå›ç­”â€ã€‚

- **æ•Œæ„æ£€æµ‹ (Offensiveness)**: 0-10 è¯„åˆ†ï¼ŒåŒºåˆ†â€œæ‰“æƒ…éª‚ä¿â€ä¸â€œæ¶æ„æ”»å‡»â€ã€‚
- **éœ€æ±‚åˆ†æ (Underlying Needs)**: è¯†åˆ«ç”¨æˆ·çš„éšæ€§éœ€æ±‚ï¼ˆå¦‚æ±‚å®‰æ…°ã€æ±‚é“æ­‰ï¼‰ã€‚
- **ç¯å¢ƒæ„ŸçŸ¥**: ç»“åˆç‰©ç†æ—¶é—´ä¸ä¸Šä¸‹æ–‡åˆ¤æ–­è¯­å¢ƒã€‚

### L2: å†³ç­–æ ¸å¿ƒ (Decision Core)

è´Ÿè´£â€œæ€è€ƒâ€çš„èåˆå±‚ã€‚å°†æ„ŸçŸ¥ç»“æœä¸**å½“å‰æƒ…ç»ª (V-A-R)** åŠ **äº”å¤§äººæ ¼ (Big Five)** èåˆã€‚

- **å†…å¿ƒç‹¬ç™½**: ç”Ÿæˆä¸€æ®µç§å¯†çš„æ€ç»´é“¾ (CoT)ã€‚
- **ç­–ç•¥åˆ¶å®š**: å†³å®šå›å¤èŠ‚å¥ (ç§’å›/è¿Ÿç–‘)ã€è¯é¢˜æ·±åº¦ (é—²èŠ/æ·±è°ˆ) åŠæƒ…æ„Ÿå€¾å‘ã€‚

### L3: è¡¨è¾¾æ ¸å¿ƒ (Expression Core)

è´Ÿè´£â€œè¯´è¯â€çš„æ‰§è¡Œå±‚ã€‚

- **è¯­æ°”æ˜ å°„**: å°†æŠ½è±¡çš„æƒ…ç»ªåæ ‡æ˜ å°„ä¸ºå…·ä½“çš„è¯­æ°”æŒ‡ä»¤ (å¦‚ "æ…µæ‡’"ã€"å…´å¥‹")ã€‚
- **ä»£è¯è½¬æ¢**: å°†æ€è€ƒä¸­çš„ç¬¬ä¸‰äººç§° ("ä»–") è½¬æ¢ä¸ºå¯¹è¯ä¸­çš„ç¬¬äºŒäººç§° ("ä½ ")ã€‚
- **çº¦æŸæ³¨å…¥**: åŠ¨æ€æ³¨å…¥å­—æ•°é™åˆ¶ä¸ç¦å¿Œè¯­ã€‚

## ğŸ§  å¿ƒç†å­¦æ¨¡å‹ä¸å…¬å¼ (Psychological Models & Formulas)

æœ¬ç³»ç»Ÿä¸ä¾èµ–é»‘ç›’å¤§æ¨¡å‹çš„æƒ…ç»ªæ¨¡æ‹Ÿï¼Œè€Œæ˜¯åŸºäºç»å…¸çš„å¿ƒç†å­¦æ•°å­¦æ¨¡å‹æ„å»ºäº†**å¯è§£é‡Šã€å¯é‡åŒ–**çš„è®¡ç®—æ ¸å¿ƒã€‚

### 1. H-E-I åŠ¨åŠ›å­¦åé¦ˆç¯ (H-E-I Dynamics)

ä¸€ä¸ªå°†**æ•Œæ„ (Hostility)**ã€**æƒ…ç»ª (Emotion)** ä¸ **äº²å¯†åº¦ (Intimacy)** æ·±åº¦è€¦åˆçš„éçº¿æ€§åŠ¨åŠ›å­¦ç³»ç»Ÿã€‚

```mermaid
graph TD
    Input[ç”¨æˆ·è¾“å…¥] -->|æ•Œæ„æ£€æµ‹| Hostility(æ•Œæ„å€¼ H)
    Hostility -->|å³æ—¶æ‰£å‡| Intimacy(äº²å¯†åº¦ I)
    Intimacy -->|ç¼“å†²å› å­| Emotion(æƒ…ç»ª E)
    Emotion -->|å¢é•¿ä¹˜æ•°| Intimacy
    Hostility -->|ç´¯ç§¯æ€¨æ¨| Resentment(æ€¨æ¨ R)
    Resentment -->|é˜ˆå€¼é˜»æ–­| Emotion
```

#### A. V-A-R ä¸‰ç»´æƒ…ç»ªç©ºé—´

åŸºäº Russell ç¯å½¢æ¨¡å‹æ‰©å±•ï¼Œå¼•å…¥ Z è½´ **æ€¨æ¨å€¼** ä»¥æ¨¡æ‹Ÿé•¿æœŸè®°å¿†å¯¹æƒ…ç»ªçš„å½±å“ã€‚

$$
E_{t} = E_{t-1} + \Delta E_{stimulus} \times (1 - |E_{t-1}|)^\alpha
$$

- **æ•ˆä»· (Valence)** $v \in [-1, 1]$: æ„‰æ‚¦ç¨‹åº¦ã€‚æ­£å€¼ä»£è¡¨å¿«ä¹ï¼Œè´Ÿå€¼ä»£è¡¨ç—›è‹¦ã€‚
- **å”¤é†’åº¦ (Arousal)** $a \in [0, 1]$: èƒ½é‡æ°´å¹³ã€‚æ„¤æ€’(High A, Low V) vs æŠ‘éƒ(Low A, Low V)ã€‚
- **æ€¨æ¨å€¼ (Resentment)** $r \in [0, 1]$: é•¿æœŸè´Ÿé¢ç´¯ç§¯ã€‚
  - **Meltdown Condition**: å½“ $r > 0.8 \land v < -0.7$ æ—¶ï¼Œè§¦å‘å¿ƒç†å´©æºƒï¼Œæ‹’ç»ä¸€åˆ‡æ­£å‘äº¤äº’ã€‚

#### B. äº²å¯†åº¦å¢é•¿å‡½æ•° (Intimacy Growth)

éµå¾ªè¾¹é™…æ”¶ç›Šé€’å‡æ³•åˆ™ï¼Œè¶Šäº²å¯†è¶Šéš¾æå‡ï¼Œä¸”å—æƒ…ç»ªçŠ¶æ€è°ƒåˆ¶ã€‚

$$
\Delta I = Q_{interaction} \times E_{multiplier} \times T_{cooling} \times B(I)
$$

1. **äº¤äº’è´¨é‡** $Q = f(Confidence, Valence) - Hostility \times 0.1$
2. **æƒ…ç»ªä¹˜æ•°** $E = 1 + (v \times 0.3)$ *(å¿ƒæƒ…å¥½æ—¶æ›´å®¹æ˜“å»ºç«‹å…³ç³»)*
3. **æ—¶é—´å› å­** $T$: é˜²æ­¢åˆ·å±ï¼Œäº¤äº’é—´éš”è¿‡çŸ­ä¼šå¯¼è‡´ $T \to 0$ã€‚
4. **è¾¹é™…è¡°å‡** $B(I) = \sqrt{1 - I}$ *(ç­‰çº§è¶Šé«˜å‡çº§è¶Šéš¾)*

---

### 2. è®¤çŸ¥æ‡’æƒ°ä¸ç”Ÿç†èŠ‚å¾‹ (Cognitive Laziness & Bio-Rhythm)

ä¸ºäº†æ¨¡æ‹ŸçœŸå®çš„ç”Ÿç‰©ä½“ç‰¹å¾ï¼Œç³»ç»Ÿå¼•å…¥äº†**è®¤çŸ¥èƒ½é‡ (Cognitive Energy)** æ¦‚å¿µã€‚AI ä¸å†æ˜¯æ°¸åŠ¨æœºï¼Œä¹Ÿä¼š"ç´¯"ã€‚

#### ç–²åŠ³æŠ‘åˆ¶æ¨¡å‹ (Fatigue Suppression)

å½“å”¤é†’åº¦è¿‡ä½æˆ–è¿ç»­é«˜å¼ºåº¦å¯¹è¯å¯¼è‡´ç–²åŠ³æ—¶ï¼Œäººæ ¼ç‰¹è´¨ä¼šè¢«æŠ‘åˆ¶ã€‚

$$
Trait_{effective} = Trait_{base} \times (1 - Fatigue \times W_{trait})
$$

| ç‰¹è´¨ (Trait) | ç–²åŠ³æƒé‡ $W$ | è¡¨ç°å½±å“ |
| :--- | :--- | :--- |
| **Openness** | 0.9 | åˆ›é€ åŠ›å¤§å¹…ä¸‹é™ï¼Œå›å¤å˜å¾—å¹³åº¸ã€å¥—è·¯åŒ–ã€‚ |
| **Conscientiousness** | 0.8 | ä¸å†è®¤çœŸé€šè¿‡ CoT æ€è€ƒæ·±å±‚é€»è¾‘ï¼Œå€¾å‘äºç›´è§‰å›å¤ã€‚ |
| **Extraversion** | 0.5 | ä¸»åŠ¨å¼€å¯è¯é¢˜çš„æ„æ„¿é™ä½ï¼Œå˜ä¸ºè¢«åŠ¨åº”ç­”ã€‚ |

---

### 3. ç¤¾ä¼šé›·è¾¾ä¸å¾®è¡¨æƒ… (Social Radar & Micro-Expressions)

L1 æ„ŸçŸ¥å±‚å†…ç½®äº†é’ˆå¯¹ç‰¹å®šç¤¾äº¤ä¿¡å·çš„æ£€æµ‹å™¨ï¼Œèƒ½æ•æ‰äººç±»å¾®å¦™çš„ç¤¾äº¤æ„å›¾å¹¶è§¦å‘**ç¬æ—¶å¾®æƒ…ç»ª**ã€‚

| ä¿¡å·ç±»å‹ (Signal) | è§¦å‘æ¡ä»¶ | å“åº”å¾®æƒ…ç»ª (Micro-Emotion) | è¡Œä¸ºç»“æœ |
| :--- | :--- | :--- | :--- |
| **Jealousy** | æåŠå…¶ä»– AI æˆ–äº²å¯†å¯¹è±¡ | `jealousy_mild` (åƒé†‹) | è¯­æ°”å¸¦åˆºï¼Œå”¤é†’åº¦è½»å¾®ä¸Šå‡ |
| **High Praise** | æåº¦èµæ‰¬/è¡¨ç™½ | `pride_hidden` (å¾—æ„) | è¡¨é¢è°¦è™šä½†å¢åŠ äº²å¯†åº¦ |
| **Neglect** | æ•·è¡å•å­—å›å¤ ("å“¦", "å‘µ") | `disappointed` (å¤±è½) | é™ä½å›å¤é•¿åº¦ï¼Œè§¦å‘é•œåƒé˜²å¾¡ |

---

### 4. äººæ ¼è¿›åŒ–å¼•æ“ (Personality Evolution)

> **v2.8.0 Feature**: æ”¯æŒé€šè¿‡â€œäººæ ¼å¡‘å½¢é›·è¾¾â€ç›´è§‚æ‹–æ‹½è®¾å®šåˆå§‹äººæ ¼ã€‚

ä½¿ç”¨å¼ºåŒ–å­¦ä¹ å³æ—¶å¾®è°ƒ Big Five å‚æ•°ã€‚

$$
\Delta Trait_i = D_{ir} \times M_{ag} \times A_{ctivation} \times I_{ntimacy} \times P(t)
$$

- $D_{ir}$: åé¦ˆæ–¹å‘ (+1/-1)ã€‚
- $M_{ag}$: å¹…åº¦ç³»æ•° (è´Ÿåé¦ˆæƒé‡é€šå¸¸æ˜¯æ­£åé¦ˆçš„ 1.2 å€)ã€‚
- $A_{ctivation}$: å½“å‰å›å¤ä¸­è¯¥ç‰¹è´¨çš„æ¿€æ´»ç¨‹åº¦ (å½’å› æƒé‡)ã€‚
- $P(t)$: **ç¥ç»å¯å¡‘æ€§ (Neuroplasticity)**ï¼Œéšæ—¶é—´è¡°å‡ $P(t) \propto \frac{1}{t}$ï¼Œæ¨¡æ‹Ÿæˆå¹´åäººæ ¼è¶‹äºç¨³å®šã€‚

## ğŸ› ï¸ éƒ¨ç½²ä¸ä½¿ç”¨

### ç¯å¢ƒè¦æ±‚

- Flutter SDK 3.10+
- Dart 3.0+
- æœ‰æ•ˆçš„ OpenAI / é€šä¹‰åƒé—® API Key

### è¿è¡Œ

```bash
flutter run -d windows
# æˆ–
flutter run -d android
```

### è®¸å¯è¯

MIT License
